<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>War Lords - لعبة حرب محسنة</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c1a25, #1a3c2d);
            color: white;
            overflow: hidden;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #gameCanvas {
            background: #1a3c2d;
            display: block;
            cursor: crosshair;
        }
        
        #performancePanel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            border: 1px solid #3498db;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="performancePanel">
            FPS: <span id="fpsCounter">60</span> | 
            الوحدات: <span id="unitsCounter">0</span>
        </div>
    </div>

    <script>
        class HighPerformanceGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d', { alpha: false });
                this.performance = {
                    fps: 0,
                    frameCount: 0,
                    lastFpsUpdate: 0,
                    units: 0
                };
                
                this.setupCanvas();
                this.initGame();
                this.startGameLoop();
            }

            setupCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                
                // تحسين جودة الرسم
                this.ctx.imageSmoothingEnabled = false;
                this.ctx.webkitImageSmoothingEnabled = false;
                this.ctx.mozImageSmoothingEnabled = false;
            }

            initGame() {
                this.units = new Map();
                this.buildings = new Map();
                this.particles = [];
                
                // إنشاء وحدات أولية
                this.createInitialUnits();
                
                // بدء تحديث العدادات
                setInterval(() => this.updatePerformance(), 1000);
            }

            createInitialUnits() {
                // إنشاء وحدات الزرقاء
                for (let i = 0; i < 5; i++) {
                    this.createUnit('soldier', 100 + i * 60, this.canvas.height - 150, 'blue');
                }
                
                // إنشاء وحدات الحمراء
                for (let i = 0; i < 5; i++) {
                    this.createUnit('soldier', this.canvas.width - 200 - i * 60, this.canvas.height - 150, 'red');
                }
            }

            createUnit(type, x, y, team) {
                const id = `unit_${Date.now()}_${Math.random()}`;
                const unit = {
                    id, type, x, y, team,
                    targetX: x, targetY: y,
                    health: 100, maxHealth: 100,
                    speed: 2 + Math.random(),
                    lastUpdate: Date.now()
                };
                
                this.units.set(id, unit);
                return unit;
            }

            startGameLoop() {
                let lastTime = 0;
                const fps = 60;
                const frameInterval = 1000 / fps;
                let delta = 0;

                const gameLoop = (currentTime) => {
                    delta += currentTime - lastTime;
                    lastTime = currentTime;

                    while (delta >= frameInterval) {
                        this.update(frameInterval);
                        delta -= frameInterval;
                    }

                    this.render();
                    this.performance.frameCount++;
                    requestAnimationFrame(gameLoop);
                };

                requestAnimationFrame(gameLoop);
            }

            update(deltaTime) {
                const now = Date.now();
                
                // تحديث الوحدات
                for (const unit of this.units.values()) {
                    this.updateUnit(unit, deltaTime, now);
                }
                
                // تحديث الجسيمات
                this.updateParticles(deltaTime);
            }

            updateUnit(unit, deltaTime, now) {
                // حركة سلسة
                const dx = unit.targetX - unit.x;
                const dy = unit.targetY - unit.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 2) {
                    const moveDistance = unit.speed * (deltaTime / 16);
                    unit.x += (dx / distance) * Math.min(moveDistance, distance);
                    unit.y += (dy / distance) * Math.min(moveDistance, distance);
                }
                
                unit.lastUpdate = now;
            }

            updateParticles(deltaTime) {
                // إزالة الجسيمات المنتهية
                this.particles = this.particles.filter(particle => {
                    particle.life -= deltaTime;
                    return particle.life > 0;
                });
            }

            render() {
                // مسح الشاشة بشكل فعال
                this.ctx.fillStyle = '#1a3c2d';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // رسم الأرض
                this.drawOptimizedGround();
                
                // رسم الوحدات
                this.drawOptimizedUnits();
                
                // رسم الجسيمات
                this.drawParticles();
            }

            drawOptimizedGround() {
                this.ctx.fillStyle = '#8B4513';
                this.ctx.fillRect(0, this.canvas.height - 100, this.canvas.width, 100);
                
                // رسم عشب محسن
                this.ctx.fillStyle = '#556B2F';
                this.ctx.beginPath();
                for (let i = 0; i < this.canvas.width; i += 20) {
                    this.ctx.rect(i, this.canvas.height - 100, 10, 8);
                }
                this.ctx.fill();
            }

            drawOptimizedUnits() {
                // تجميع الوحدات حسب الفريق للرسم الأمثل
                const blueUnits = [];
                const redUnits = [];
                
                for (const unit of this.units.values()) {
                    if (unit.team === 'blue') blueUnits.push(unit);
                    else redUnits.push(unit);
                }
                
                // رسم الوحدات الزرقاء
                this.ctx.fillStyle = '#3498db';
                blueUnits.forEach(unit => this.drawAdvancedUnit(unit));
                
                // رسم الوحدات الحمراء
                this.ctx.fillStyle = '#e74c3c';
                redUnits.forEach(unit => this.drawAdvancedUnit(unit));
            }

            drawAdvancedUnit(unit) {
                this.ctx.save();
                this.ctx.translate(unit.x, unit.y);
                
                // ظل الوحدة
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
                this.ctx.fillRect(-9, 6, 18, 8);
                
                // جسم الوحدة الرئيسي
                this.ctx.fillRect(-8, -12, 16, 24);
                
                // رأس الوحدة
                this.ctx.fillStyle = unit.team === 'blue' ? '#2980b9' : '#c0392b';
                this.ctx.fillRect(-6, -16, 12, 8);
                
                // شريط الصحة المحسن
                this.drawEnhancedHealthBar(unit.health, unit.maxHealth);
                
                this.ctx.restore();
            }

            drawEnhancedHealthBar(current, max) {
                const width = 30;
                const height = 4;
                const ratio = current / max;
                
                // خلفية شريط الصحة
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                this.ctx.fillRect(-width/2, -25, width, height);
                
                // شريط الصحة
                const gradient = this.ctx.createLinearGradient(-width/2, 0, width/2, 0);
                if (ratio > 0.6) {
                    gradient.addColorStop(0, '#2ecc71');
                    gradient.addColorStop(1, '#27ae60');
                } else if (ratio > 0.3) {
                    gradient.addColorStop(0, '#f39c12');
                    gradient.addColorStop(1, '#e67e22');
                } else {
                    gradient.addColorStop(0, '#e74c3c');
                    gradient.addColorStop(1, '#c0392b');
                }
                
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(-width/2, -25, width * ratio, height);
                
                // حدود شريط الصحة
                this.ctx.strokeStyle = '#2c3e50';
                this.ctx.lineWidth = 1;
                this.ctx.strokeRect(-width/2, -25, width, height);
            }

            drawParticles() {
                // رسم جسيمات الأداء
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                for (let i = 0; i < 10; i++) {
                    const x = Math.random() * this.canvas.width;
                    const y = Math.random() * this.canvas.height;
                    const size = Math.random() * 2;
                    this.ctx.fillRect(x, y, size, size);
                }
            }

            updatePerformance() {
                const now = Date.now();
                const elapsed = now - this.performance.lastFpsUpdate;
                
                this.performance.fps = Math.round(
                    (this.performance.frameCount * 1000) / elapsed
                );
                this.performance.units = this.units.size;
                this.performance.lastFpsUpdate = now;
                this.performance.frameCount = 0;
                
                // تحديث العرض
                document.getElementById('fpsCounter').textContent = this.performance.fps;
                document.getElementById('unitsCounter').textContent = this.performance.units;
            }

            // إضافة وحدة جديدة عند النقر
            addUnitAt(x, y) {
                this.createUnit('soldier', x, y, 'blue');
            }
        }

        // بدء اللعبة مع إضافة التحكم
        let game;
        window.addEventListener('load', () => {
            game = new HighPerformanceGame();
            
            // إضافة وحدات عند النقر
            document.getElementById('gameCanvas').addEventListener('click', (e) => {
                const rect = game.canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                game.addUnitAt(x, y);
            });
            
            // إضافة وحدات عشوائية عند الضغط على المسافة
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space') {
                    for (let i = 0; i < 5; i++) {
                        const x = 100 + Math.random() * (game.canvas.width - 200);
                        const y = 100 + Math.random() * (game.canvas.height - 200);
                        game.addUnitAt(x, y);
                    }
                    e.preventDefault();
                }
            });
        });

        // تحسين حجم Canvas عند تغيير حجم النافذة
        window.addEventListener('resize', () => {
            if (game) {
                game.canvas.width = window.innerWidth;
                game.canvas.height = window.innerHeight;
            }
        });
    </script>
</body>
</html>
